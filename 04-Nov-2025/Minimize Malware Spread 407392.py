# Problem: Minimize Malware Spread - https://leetcode.com/problems/minimize-malware-spread/

class Solution:
    def minMalwareSpread(self, graph: List[List[int]], initial: List[int]) -> int:
        n = len(graph)
        adj_lst = defaultdict(set)

        for r in range(n):
            for c in range(n):
                if graph[r][c] == 1 and r != c:
                    adj_lst[r].add(c)
                    adj_lst[c].add(r)
        # print(adj_lst)
        visited = set()
        def dfs(node):
            comp = []
            stk = [node]

            while stk:
                curr = stk.pop()
                if curr in visited : 
                    continue
                visited.add(curr)
                comp.append(curr)
                for neb in adj_lst[curr]:
                    if neb not in visited:
                        stk.append(neb)
            return comp
        
        components = []

        for i in initial:
            if i not in visited:
                components.append(dfs(i))

        # print(components)
        comp_idx = {}
        for idx, comp in enumerate(components):
            for n in comp:
                comp_idx[n] = idx
        
        infected_node_comp = defaultdict(int)
        for n in initial:
            infected_node_comp[comp_idx[n]] += 1
        
        ans = (-1, min(initial))

        for i in range(len(initial)):
            if infected_node_comp[comp_idx[initial[i]]] == 1:
                saved = len(components[comp_idx[initial[i]]])
                if saved > ans[0] or saved == ans[0] and ans[1] > initial[i]:
                    ans = (saved, initial[i])
        return ans[1]